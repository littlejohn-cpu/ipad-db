<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>iPad Database</title>

<style>
/* ===== 基本 ===== */
body {
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  font-size: 13px;
  line-height: 1.4;
  overflow: hidden;
  background: #111;
  color: #eee;
}

.container {
  height: 100vh;
}

/* ===== 一覧 ===== */
.list-area {
  height: 100%;
  overflow-y: auto;
  overflow-x: auto;
  overscroll-behavior: contain;
}

table {
  width: max-content;
  min-width: 100%;
  border-collapse: collapse;
  table-layout: auto;
}

th, td {
  border: 1px solid #444;
  padding: 4px 6px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

thead th {
  position: sticky;
  top: 0;
  background: #222;
  z-index: 2;
  cursor: pointer;
  user-select: none;
}

/* 行選択 */
tr.selected {
  background: #2a5bd7;
}

/* ソート表示 */
th.asc::after { content: " ▲"; font-size: 10px; }
th.desc::after { content: " ▼"; font-size: 10px; }

/* カラム幅 */
.col-no { width: 48px; }
.col-category { width: 80px; font-weight: 600; }
.col-maker { width: 120px; font-weight: 600; }
.col-title1 { width: 160px; }
.col-title2 { width: 160px; }

/* ===== 詳細 ===== */
.detail {
  padding: 8px;
  box-sizing: border-box;
}

.detail-mail {
  font-size: 14px;
  font-weight: bold;
  word-break: break-all;
}

.copy-btn {
  margin: 6px 0;
  padding: 6px;
  background: #2a5bd7;
  border: none;
  color: #fff;
  border-radius: 4px;
}

.detail-image img {
  max-width: 100%;
  height: auto;
  display: block;
}

/* ===== 横向き：6:4 ===== */
@media (orientation: landscape) {
  .container {
    display: grid;
    grid-template-columns: 6fr 4fr;
  }
}

/* ===== 縦向き：上7 下3 ===== */
@media (orientation: portrait) {
  .container {
    display: grid;
    grid-template-rows: 7fr 3fr;
  }

  .detail {
    display: grid;
    grid-template-columns: 1fr 1fr;
    grid-template-rows: auto auto;
    gap: 8px;
  }

  .detail-mail,
  .detail-titles {
    grid-column: 1 / 2;
  }

  .detail-image {
    grid-column: 2 / 3;
    grid-row: 1 / 3;
  }
}
</style>
</head>

<body>

<div class="container">
  <!-- 一覧 -->
  <div class="list-area">
    <table>
      <thead>
        <tr>
          <th class="col-no" data-key="no">No</th>
          <th class="col-category" data-key="category">分類</th>
          <th class="col-maker" data-key="maker">メーカー</th>
          <th class="col-title1" data-key="title1">タイトル1</th>
          <th class="col-title2" data-key="title2">タイトル2</th>
        </tr>
      </thead>
      <tbody id="tableBody"></tbody>
    </table>
  </div>

  <!-- 詳細 -->
  <div class="detail">
    <div>
      <div class="detail-mail" id="mail"></div>
      <button class="copy-btn" onclick="copyMail()">メールコピー</button>
    </div>

    <div class="detail-titles">
      <div id="title1"></div>
      <div id="title2"></div>
    </div>

    <div class="detail-image">
      <img id="image" src="">
    </div>
  </div>
</div>

<script>
let data = [];
let originalData = [];
let currentSortKey = null;
let sortDir = 1;

/* ===== CSV読み込み（安全パーサ） ===== */
fetch("data.csv")
  .then(r => r.text())
  .then(text => {
    data = parseCSV(text);
    originalData = [...data];
    renderTable();
  });

function parseCSV(text) {
  const lines = text.trim().split("\n");
  const headers = lines.shift().split(",");

  return lines.map(line => {
    const values = [];
    let current = "";
    let inQuotes = false;

    for (let i = 0; i < line.length; i++) {
      const c = line[i];
      if (c === '"') {
        inQuotes = !inQuotes;
      } else if (c === "," && !inQuotes) {
        values.push(current);
        current = "";
      } else {
        current += c;
      }
    }
    values.push(current);

    const obj = {};
    headers.forEach((h, i) => {
      obj[h] = (values[i] || "").replace(/^"|"$/g, "").trim();
    });
    return obj;
  });
}

/* ===== 描画 ===== */
function renderTable() {
  const body = document.getElementById("tableBody");
  body.innerHTML = "";

  data.forEach(row => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td class="col-no">${row.no}</td>
      <td class="col-category">${row.category}</td>
      <td class="col-maker">${row.maker}</td>
      <td class="col-title1">${row.title1}</td>
      <td class="col-title2">${row.title2}</td>
    `;
    tr.onclick = () => selectRow(tr, row);
    body.appendChild(tr);
  });
}

/* ===== 行選択 ===== */
function selectRow(tr, row) {
  document.querySelectorAll("#tableBody tr").forEach(r => r.classList.remove("selected"));
  tr.classList.add("selected");

  document.getElementById("mail").textContent = row.email;
  document.getElementById("title1").textContent = row.title1;
  document.getElementById("title2").textContent = row.title2;
  document.getElementById("image").src = row.image;
}

/* ===== コピー ===== */
function copyMail() {
  navigator.clipboard.writeText(
    document.getElementById("mail").textContent
  );
}

/* ===== ソート ===== */
document.querySelectorAll("th[data-key]").forEach(th => {
  th.onclick = () => {
    const key = th.dataset.key;

    if (currentSortKey === key) {
      sortDir *= -1;
    } else {
      currentSortKey = key;
      sortDir = 1;
    }

    data.sort((a, b) => {
      if (a[key] < b[key]) return -1 * sortDir;
      if (a[key] > b[key]) return 1 * sortDir;
      return 0;
    });

    document.querySelectorAll("th").forEach(t => t.classList.remove("asc", "desc"));
    th.classList.add(sortDir === 1 ? "asc" : "desc");

    renderTable();
  };
});

/* ===== 斜めスクロール防止（方向ロック） ===== */
const listArea = document.querySelector(".list-area");
let startX = 0, startY = 0;

listArea.addEventListener("touchstart", e => {
  startX = e.touches[0].clientX;
  startY = e.touches[0].clientY;
}, { passive: true });

listArea.addEventListener("touchmove", e => {
  const dx = Math.abs(e.touches[0].clientX - startX);
  const dy = Math.abs(e.touches[0].clientY - startY);

  if (dx > dy) {
    listArea.style.overflowY = "hidden";
    listArea.style.overflowX = "auto";
  } else {
    listArea.style.overflowX = "hidden";
    listArea.style.overflowY = "auto";
  }
}, { passive: true });

listArea.addEventListener("touchend", () => {
  listArea.style.overflowX = "auto";
  listArea.style.overflowY = "auto";
});
</script>

</body>
</html>
