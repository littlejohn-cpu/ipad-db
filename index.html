<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>iPad Database</title>

<style>
/* ===== 基本 ===== */
body {
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  font-size: 13px;
  line-height: 1.4;
  overflow: hidden;
  background: #111;
  color: #eee;
}

.container {
  height: 100vh;
}

/* ===== 一覧 ===== */
.list-area {
  overflow-y: auto;
  height: 100%;
}

table {
  width: 100%;
  border-collapse: collapse;
}

th, td {
  border: 1px solid #444;
  padding: 4px 6px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

thead th {
  position: sticky;
  top: 0;
  background: #222;
  z-index: 2;
  cursor: pointer;
  user-select: none;
}

tr.selected {
  background: #2a5bd7;
}

/* ソート表示 */
th.asc::after { content: " ▲"; font-size: 10px; }
th.desc::after { content: " ▼"; font-size: 10px; }

/* カラム幅 */
.col-no { width: 48px; }
.col-category { width: 80px; }
.col-maker { width: 120px; }
.col-title1 { width: 160px; }
.col-title2 { width: 160px; }

/* ===== 詳細 ===== */
.detail {
  padding: 8px;
  box-sizing: border-box;
}

.detail-mail {
  font-size: 14px;
  font-weight: bold;
  word-break: break-all;
}

.copy-btn {
  margin: 6px 0;
  padding: 6px;
  background: #2a5bd7;
  border: none;
  color: #fff;
  border-radius: 4px;
}

.detail-image img {
  max-width: 100%;
  height: auto;
}

/* ===== 横向き ===== */
@media (orientation: landscape) {
  .container {
    display: grid;
    grid-template-columns: 6fr 4fr;
  }
}

/* ===== 縦向き ===== */
@media (orientation: portrait) {
  .container {
    display: grid;
    grid-template-rows: 1fr auto;
  }

  .detail {
    display: grid;
    grid-template-columns: 1fr 1fr;
    grid-template-rows: auto auto;
    gap: 8px;
  }

  .detail-mail,
  .detail-titles {
    grid-column: 1 / 2;
  }

  .detail-image {
    grid-column: 2 / 3;
    grid-row: 1 / 3;
  }
}
</style>
</head>

<body>

<div class="container">
  <!-- 一覧 -->
  <div class="list-area">
    <table>
      <thead>
        <tr>
          <th class="col-no" data-key="no">No</th>
          <th class="col-category" data-key="category">分類</th>
          <th class="col-maker" data-key="maker">メーカー</th>
          <th class="col-title1" data-key="title1">タイトル1</th>
          <th class="col-title2" data-key="title2">タイトル2</th>
        </tr>
      </thead>
      <tbody id="tableBody"></tbody>
    </table>
  </div>

  <!-- 詳細 -->
  <div class="detail">
    <div class="detail-mail" id="mail"></div>
    <button class="copy-btn" onclick="copyMail()">メールコピー</button>

    <div class="detail-titles">
      <div id="title1"></div>
      <div id="title2"></div>
    </div>

    <div class="detail-image">
      <img id="image" src="">
    </div>
  </div>
</div>

<script>
let data = [];
let originalData = [];
let currentSortKey = null;
let sortDir = 1;

fetch("data.csv")
  .then(r => r.text())
  .then(text => {
    const lines = text.trim().split("\n");
    const keys = lines.shift().split(",");

    data = lines.map(line => {
      const values = line.split(",");
      let obj = {};
      keys.forEach((k, i) => obj[k] = values[i]);
      return obj;
    });

    originalData = [...data];
    renderTable();
  });

function renderTable() {
  const body = document.getElementById("tableBody");
  body.innerHTML = "";

  data.forEach((row, i) => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${row.no}</td>
      <td>${row.category}</td>
      <td>${row.maker}</td>
      <td>${row.title1}</td>
      <td>${row.title2}</td>
    `;

    tr.onclick = () => selectRow(tr, row);
    body.appendChild(tr);
  });
}

function selectRow(tr, row) {
  document.querySelectorAll("tr").forEach(r => r.classList.remove("selected"));
  tr.classList.add("selected");

  document.getElementById("mail").textContent = row.email;
  document.getElementById("title1").textContent = row.title1;
  document.getElementById("title2").textContent = row.title2;
  document.getElementById("image").src = row.image;
}

function copyMail() {
  navigator.clipboard.writeText(
    document.getElementById("mail").textContent
  );
}

/* ソート */
document.querySelectorAll("th[data-key]").forEach(th => {
  th.onclick = () => {
    const key = th.dataset.key;

    if (currentSortKey === key) {
      sortDir *= -1;
    } else {
      currentSortKey = key;
      sortDir = 1;
    }

    data.sort((a, b) => {
      if (a[key] < b[key]) return -1 * sortDir;
      if (a[key] > b[key]) return 1 * sortDir;
      return 0;
    });

    document.querySelectorAll("th").forEach(t => t.classList.remove("asc", "desc"));
    th.classList.add(sortDir === 1 ? "asc" : "desc");

    renderTable();
  };
});
</script>

</body>
</html>
